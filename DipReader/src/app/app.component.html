<div class="container">
<div class="sidebar">
    <h3>Esplora DIP</h3>
    <button (click)="downloadDb()" style="margin-bottom: 10px; cursor: pointer;">ğŸ’¾ Scarica DB Debug</button>
    <!-- debug 
    <div style="font-size: 10px; color: red; background: #eee; padding: 5px;">
        DEBUG DATI: {{ fileTree.length }} nodi
        <pre>{{ fileTree | json }}</pre>
    </div>
    -->
    <ul>
      <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: fileTree }"></ng-container>
    </ul>
  </div>

  <div class="main">
    <div *ngIf="selectedFile; else noSelect">
      <h2>{{ selectedFile.name }}</h2>
      <button (click)="openFile(selectedFile!)">Apri File Originale</button>
      
      <!-- Mostra un messaggio di errore se il caricamento dei metadati fallisce -->
      <div *ngIf="metadata?.error" class="metadata-box error-box">
        <h3>Errore</h3>
        <p>{{ metadata.error }}</p>
      </div>
      
      <!-- Mostra i metadati solo se non ci sono errori e l'oggetto metadata esiste -->
      <div *ngIf="metadata && !metadata.error" class="metadata-box">
        <h3>Tutti i Metadati</h3>
        <!-- Usiamo il pipe 'json' per visualizzare l'intero oggetto. Ãˆ il modo piÃ¹ semplice e affidabile per vedere TUTTI i dati. -->
        <pre>{{ metadata | json }}</pre>
      </div>
    </div>
    <ng-template #noSelect>
      <p class="placeholder">Seleziona un file per vedere i dettagli.</p>
    </ng-template>
  </div>
</div>

<ng-template #recursiveList let-nodes>
  <li *ngFor="let node of nodes">
    <span (click)="handleNodeClick(node)" [class.is-folder]="node.type === 'folder'">
      {{ node.type === 'folder' ? 'ğŸ“' : 'ğŸ“„' }} {{ node.name }}
    </span>
    <ul *ngIf="node.type === 'folder' && node.expanded">
      <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: node.children }"></ng-container>
    </ul>
  </li>
</ng-template>